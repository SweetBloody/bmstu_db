# Базы данных. Лекция 6

S1 и S2 - мн-ва функциональных зависимостей

S1 = S2 <=> S1+ = S2+

```
F = {A ➝ C, AC ➝ D, E ➝ AD, E ➝ H}
G = {A ➝ CD, E ➝ AH}

R (A, B, C, D, E, F, H)

1. G покрывается F - верно
    {A}+ = {C, D, A} = A ➝ CD
    {E}+ = {E, A, D, H, C} = {E, A, H, C, D}
    
2. F покрывается G - верно
    {A}+ = {A, C, D} = {A, C, D}
    {AC}+ = {A, C, D} = {A, C, D}
    {E}+ = {E, A, H, C, D} = {E, A, C, D, H}
```

#### Неприводимое множество функциональных зависимостей
1. Для всех Функциональных зависимостей зависимая часть - простая (не составная)

    зависимая часть = 1 атрибут
2. Ни один атрибут из детерминанта нельзя удалить
3. Ни одна функциональная зависимость не может быть изменена без изменения замыкания этого множества

Свойства:
* каждая функциональная зависимость этого множества имеет одно-элементную правую часть
* ни один атрибут не может быть удален из левой части функциональной зависимости (детерминанта) без изменения замыкания данного множества 
* ни одна функцияональная зависимость не может быть устранена без изменения замыкания этого множества 


---
Пример:
```
Pno ➝ Pname 
Pno ➝ Color  
Pno ➝ Weight 
Pno ➝ City 
```

{Pno} - первичный ключ

Множество ФЗ неприводимое, потому что:
* правая часть из одного элемента
* левая часть из одного элемента
* все ФЗ разные (нельзя ничего выкинуть)

---
Пример 2:
```
Pno ➝ {Pname, Color} - нарушение п.1   
Pno ➝ Weight 
Pno ➝ City 
```

Правая часть - составная (нарушение п.1)

---
Пример 3:
``` 
{Pno, Pname} ➝ Color - нарушение п.2 (Pname можно выкинуть)
Pno ➝ Pname  
Pno ➝ Weight 
Pno ➝ City  
```

Доказательство (что можно выкинуть Pname):
```
Pno Pno ➝ Pno Pname ➝ Color 
Pno Pno ➝ Color 
Pno ➝ Color (вывели из Pno ➝ Color без Pname)
```

---
Пример 4:
``` 
Pno ➝ Pno - нарушение п.3 (тривиальная запись)
Pno ➝ Pname  
Pno ➝ Color 
Pno ➝ Weight 
Pno ➝ City  
```

---
Пример 5

Найти неприводимое множество ФЗ
```
R (A, B, C, D)
A ➝ BC
B ➝ C 
A ➝ B 
AB ➝ C 
AC ➝ D 

1) A ➝ B 
   A ➝ C
   B ➝ C 
   A ➝ B (-)
   AB ➝ C 
   AC ➝ D 
2) A ➝ B 
   A ➝ C (-) 
   B ➝ C 
   AB ➝ C (-) 
   AC ➝ D 
3) A ➝ B 
   B ➝ C 
   AC ➝ D 
```

### Нормализация отношений
1. минимальный объем базы данных
2. уменьшение риска отношений

Свойства нормализации:
1. декомпозиция без потерь
2. свойство сохранения функциональных зависимостей

Декомпозиция без потерь
> **Декомпозицией отношения** R называется замена R на совокупность отношений {R1, R2, ..Rn}, такую что каждая из них есть проекция отношения R. При этом каждый атрибут отношения R входит хотя бы в одну из проекций декомпозиции

```
R (a, b, c)
{a}, {b}, {c}
{a}, {bc}
{ab}, {c}
{ab}, {bc}
{a}, {ab}, {ac}
```

---
Пример:

R:

|a|b|c|
|---|---|---|
|Москва|Россия|столица|
|Томск|Россия|не столица|
|Берлин|Германия|столица|

**1 варик**
```
R = {a} V {b, c} (декомпозиция с потерями)
R1 = {a}
R2 = {b, c}
```

R1:

|a|
|---|
|Москва|
|Томск|
|Берлин|

R2:

b|c 
---|---
Россия|столица
Россия|не столица
Германия|столица

R1 join R2 (декартово произведение):

a|b|c 
---|---|---
Москва|Россия|столица
Москва*|Россия*|не столица*
Москва*|Германия*|столица*
Томск|Россия|столица
Томск|Россия|не столица
...|...|...

Строки со звездочками - появились новые кортежи

**2 варик**
```
R = {a, b} V {a, c} (декомпозиция без потерь)
R1 = {a, c}
R2 = {a, b}
```

R1:

|a|c
|---|---
|Москва|столица
|Томск|не столица
|Берлин|столица

R2:

a|b
---|---
Москва|Россия
Томск|Россия
Берлин|Германия

R1 join R2 (соединяем по a):

a|b|c
---|---|---
Москва|Россия|столица
Томск|Россия|не столица
Берлин|Германия|столица


### 1 нормальная форма (1NF)
Отношение находится в **1 НФ**, если:
* все его атрибуты являются простыми
* все используемые домены содержат только скалярные значения - **св-во атомарности**.

|Фирма|Модель|
|---|---|
|BMW|M5, M1, X5M|
|Nissan|GT-R|

Нужно декомпозировать:

|Фирма|Модель|
|---|---|
|BMW|M6|
|BMW|M1|
|BMW|X5M|
|Nissan|GT-R|


### 2 нормальная форма (2NF)
Отношение находится во **2 НФ**, если:
* оно находится в **1 НФ**
* каждый неключевой атрибут неприводимо зависит от потенциального (первичного) ключа

|Модель|Фирма|Цена|Скидка|
|---|---|---|---|
|M5|BMW|5.5|5%|
|X5M|BMW|6|5%|
|M1|BMW|2.5|5%|
|GT-R|Nissan|5|10%|

Нужно декомпозировать:

|Модель|Фирма|Цена
|---|---|---
|M5|BMW|5.5
|X5M|BMW|6
|M1|BMW|2.5
|GT-R|Nissan|5

Фирма|Скидка
---|---
BMW|5%
Nissan|10%