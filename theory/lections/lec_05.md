# Базы данных. Лекция 5

###  Исчисление кортежей

`Поставщики -<SP>- Детали`

1. ```sql
    Range of SX is (S ) where
   ```
3. ```sql
   (S.Sname) where  SX.City = 'Смоленск'
        and SX.Status > 20
   ```
4. ```sql
   Range of SX is S
   Range of PX is P
   Range of SPX is SP
   
   (SX.Sname) where exists SPX(SPX.Sno = SX.Sno and
                    exists PX(PX.Pno = SPX.Pno and 
                              PX.Color = 'red'))
   ```
5. ```sql
   Range of SX is S
   Range of SY is S
   
   (SX.Sno, SY.Sno) where SX.City = SY.City and SX.Sno > SY.Sno
   ```
6. ```sql
   Range of SX is S
   Range of SY is S
   
   (SX.Sno) where for all PX(exists SPX (SPX.Pno = PX.Pno and 
                                         SPX.Sno = SX.Sno))
   ```
7. Поставщики, которые не поставляют деталь №2
    ```sql
    SX.Sname where not exists SPX(SPX.Sno = SX.Sno and SPX.Pno = 2)
    ```
8. Общее количество поставляемых деталей (sum(выражение, атрибуты))
    ```sql
    sum(SPX, Qty) as total
    ```
9. Для каждого поставщика получить номер и количество поставляемых деталей
    ```sql
    (SX.Sno, count(SPX where SPX.Sno = SX.Sno) as total)
    ```
10. Города, в которых хранится более 5 красных деталей
     ```sql
     PX.City where count(PY where PY.Pno = PX.Pno
                         and PY.Color = 'red')
     ```

### Функциональные зависимости

|Sno|City|Pno|Qty|
|---|---|---|---|
|1|Смоленск|1|100|
|1|Смоленск|2|100|
|2|Владимир|1|200|
|2|Владимир|1|300|
|3|Владимир|2|400|
|4|Смоленск|2|400|
|4|Смоленск|4|400|
|4|Смоленск|5|400|

> Вспомним школу:  
> Y функционально зависит от X: X ➝ Y

#### Зависимости:
- {Sno} ➝ {City}
- {Sno, Pno} ➝ {Qty}
- {Sno, Pno} ➝ {City}
- {Sno, Pno} ➝ {Qty, City}
- {Sno, Pno} ➝ {Sno}

> Пусть R отношение, а X и Y - произвольные подмножества, тогда Y функционально зависит от X (X➝Y) тогда и только тогда, когда любое значение множества X связано с любым значением множества Y. Левая часть - детерминант, правая - зависимая часть, а написанная Таблица - неправильной декомпозицией

#### Аномалии:
- INSERT (аномалия вставки)
  - {Sno, City}
  - {Sno, Pno, Qty}
- DELETE (аномалия удаления)
- UPDATE (аномалия обновления)

> Функциональная зависимость называется тривиальной, когда зависимая часть включается в детерминант

> Замыкание - множество всех функциональных зависимостей, которые задаются данным множеством функциональных зависимостей. S+

### Армстронг и его правила
`R (A, B, C, D) ` 
`AB = {A, B}`
- Рефлексивность: `B ∈ A => A ➝ B`
- Дополнение: `A ➝ B => AC ➝ BC`
- Транзитивность: `A ➝ B, B ➝ C => A ➝ C`
---
- Самоопределение: `A ➝ A`
- Декомпозиция: `A ➝ BC => A ➝ B, A ➝ C`
- Объединение: `A ➝ B, A ➝ C => A ➝ BC`
- Композиция: `A ➝ B, C ➝ D => AC ➝ BD`
---

#### Пример
```
   R (A, B, C, D, E, F)
   S = {A ➝ BC, B ➝ E, CD ➝ EF}
   AD ➝ F - ?
   
1. CD ➝ EF => CD ➝ E, CD ➝ F (5)
2. A ➝ BC => A ➝ B, A ➝ C (5)
3. D ➝ D (4)
4. A ➝ C, D ➝ D => AD ➝ CD (2)
5. AD ➝ CD, CD ➝ F => AD ➝ F (3)
```

> Супер ключ - переменная отношения, которая содержит в виде подмножества (не обязательно собственного) по крайней мере 1 потенциальный ключ

> Потенциальные ключи - выборка из атрибутов, обладающих свойствами неизбыточности и уникальности

> Первичный ключ - ключ, который выбран из потенциальных ключей
 

#### Замыкание атрибутов
| |A, D|A, B, C, D, E, F|
|---|---|---|
|A ➝ BC|A, B, C, D|A, B, C, D|
|B ➝ E|A, B, C, D, E|A, B, C, D, E|
|CD ➝ EF|A, B, C, D, E, F|A, B, C, D, E, F|